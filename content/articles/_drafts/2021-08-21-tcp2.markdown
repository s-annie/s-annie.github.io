---
layout: post
title: 【通信】TCP/IP基础知识（2）
categories: Web
---
## TCP/IP协议分层模型
TCP/IP诞生以来的各种协议也能对应到OSI参考模型中。下面这个图列出了TCP/IP与OSI分层之间的大致关系。不难看出，TCP/IP与OSI在分层模块上稍有区别。OSI参考模型注重“通信协议必要的功能是什么”，而TCP/IP则更强调“在计算机上实现协议应该开发哪种程序”。

### 硬件
TCP/IP最底层是负责数据传输的硬件。这方面没有一个既定的指标，总之TCP/IP是在网络互联的设备之间能够通信的前提下才被提出的协议。

### 网卡层
网卡层利用以太网中的数据链路层进行通信，属于接口层，类似于让NIC起作用的“驱动程序”。

### 互联网层
互联网层使用IP协议，它相当于OSI模型中的第3层网络层。IP协议基于IP地址转发分包数据。TCP/IP分层中的互联网层和传输层的功能通常由操作系统提供，尤其是路由器，它必须得实现通过互联网层转发分组数据包的功能。
#### IP
IP跨越网络传送数据包，使整个互联网都能收到数据的协议。IP协议使数据能够发送的地球的另一端，这期间它使用IP地址作为主机的标识。IP还隐含着数据链路层的功能。通过IP，相互通信的主机之间不论经过怎样的底层数据链路都能够实现通信。
虽然IP也是分组交换的一种协议，但是它不具有重发机制。即使分组数据包未能到达对端主机也不会重发，因此属于非可靠性传输协议。
#### ICMP
IP数据包在发送途中一旦发生以上导致无法到达对端目标地址时，需要给发送端发送一个发生异常的通知。ICMP就是为这一功能而置顶的。它有时也被用来诊断网络的健康状况。
#### ARP
从分组数据包中的IP地址中解析出物理地址（MAC地址）的一种协议。

### 传输层
TCP/IP的传输层中有两个具有代表性的协议。该层的功能本身与OSI参考模型中的传输层类似。
传输层最主要的功能就是能够让应用程序之间实现通信。计算机内部通常同一时间运行着多个程序。为此必须分清是哪些程序与哪些程序在进行通信。识别这些应用程序的是端口号。
#### TCP
TCP是一种面向有连接的传输层协议。它可以保证两端通信主机之间的通信可达。TCP能够正确处理在传输过程中丢包，传输顺序乱掉等异常情况。此外，TCP还能够有效利用带宽，缓解网络添堵。然而，为了建立和断开链接，有时它需要至少7次的收包发包，导致网络流量的浪费。此外为了提高网络的利用率，TCP协议中定义了各种各样复杂的规范，因此不利于视频会议等场合使用。
#### UDP
UDP有别于TCP，它是一种面向无连接的传输层协议。UDP不会关注对端是否真的收到了传送过去的数据。如果需要检查对段是否收到分组数据包，或者对端是否连接到了网络，则需要在应用程序中实现。
UDP常用于分组数据较少的多媒体领域。


## TCP/IP通信示例
### 数据包首部
每个分层中，都会对所发送的数据附加一个首部。在这个首部中包含了该层必要的信息，如发送的目标地址以及协议相关信息。通常，为协议提供的信息为包首部，所要发送内容为数据。在下一层的角度看，从上一分层收到的包全部都被认为是本层的数据。
下面以假设甲给乙发送电子邮件，内容为“早上好”，

