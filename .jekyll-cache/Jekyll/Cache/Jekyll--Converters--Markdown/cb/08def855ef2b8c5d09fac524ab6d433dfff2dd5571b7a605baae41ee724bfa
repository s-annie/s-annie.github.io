I"œ,<p>RobotModelå’ŒRobotStateè¿™ä¸¤ä¸ªç±»æ˜¯è§£å†³æœºå™¨äººåŠ¨åŠ›å­¦çš„æ ¸å¿ƒã€‚ä»Šå¤©é€šè¿‡ä»£ç çœ‹çœ‹å¦‚ä½•åœ¨Moveitä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªç±»ã€‚</p>

<p>RobotModelç±»ä¸­åŒ…å«äº†é“¾æ¥ï¼ˆLinksï¼‰å’Œå…³èŠ‚ï¼ˆJointsï¼‰çš„å…³ç³»ï¼Œä»¥åŠä»URDFä¸­åŠ è½½çš„å…³èŠ‚æé™ï¼ˆjoint limitï¼‰å±æ€§ã€‚RobotModelè¿˜å°†æœºå™¨äººçš„é“¾æ¥å’Œå…³èŠ‚åˆ†ç¦»æˆSRDFä¸­å®šä¹‰çš„è§„åˆ’ç»„ã€‚<br />
RobotStateåˆ™åŒ…å«äº†æœºå™¨äººåœ¨æ¯ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šçš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…³èŠ‚ä½ç½®çš„å‘é‡ï¼Œå¯é€‰æ‹©çš„é€Ÿåº¦å’ŒåŠ é€Ÿåº¦ç­‰ã€‚è¿™äº›ä¿¡æ¯å–å†³äºæœºå™¨äººçš„å½“å‰çŠ¶æ€ï¼Œæ¯”å¦‚è¯´æœ«ç«¯æ‰§è¡Œå™¨çš„é›…å„å¸ƒç³»æ•°ã€‚RobotStateè¿˜åŒ…å«è¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ ¹æ®æœ«ç«¯æ‰§è¡Œå™¨ä½ç½®ï¼ˆç¬›å¡å°”å§¿åŠ¿ï¼‰è®¾ç½®æ‰‹è‡‚ä½ç½®ï¼Œä»¥åŠè®¡ç®—ç¬›å¡å°”è½¨è¿¹ã€‚<br />
(æœ€åè¿™æ®µè¯é‡Œçš„é›…å„å¸ƒç³»æ•°ï¼Œç¬›å¡å°”è½¨è¿¹çš„éƒ½æ˜¯äº›ä»€ä¹ˆé¬¼ä¸œè¥¿)</p>

<p>Anywayï¼Œä¸Šé¢è¿™æ®µè¯´æ˜æ˜¯MoveItå®˜æ–¹ç½‘ç«™ä¸Šå¯¹äºRobotModelå’ŒRobotStateçš„è§£é‡Šã€‚ä¸‹é¢åˆ†æ­¥éª¤æ¥çœ‹çœ‹å¦‚ä½•åœ¨ä»£ç é‡Œä½¿ç”¨è¿™ä¸¤ä¸ªç±»ã€‚</p>

<h3 id="start">Start</h3>
<p>åˆå§‹åŒ–<code class="language-plaintext highlighter-rouge">RobotModelLoader</code>å¯¹è±¡ï¼ŒåŠ è½½ROS pamameter serverä¸Šçš„<code class="language-plaintext highlighter-rouge">robot_description</code>ï¼Œå¯è¿”å›ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">RobotModel</code>çš„å…±äº«æŒ‡é’ˆã€‚</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// loop up the robot description on the ROS parameter</span>
<span class="n">robot_model_loader</span><span class="o">::</span><span class="n">RobotModelLoader</span> <span class="nf">robot_model_loader</span><span class="p">(</span><span class="s">"robot_description"</span><span class="p">);</span>

<span class="c1">// construct a RobotModel to use</span>
<span class="n">robot_model</span><span class="o">::</span><span class="n">RobotModelPtr</span> <span class="n">kinematic_model</span> <span class="o">=</span> <span class="n">robot_model_loader</span><span class="p">.</span><span class="n">getModel</span><span class="p">();</span>
<span class="n">ROS_INFO</span><span class="p">(</span><span class="s">"Model frame: %s"</span><span class="p">,</span> <span class="n">kinematic_model</span><span class="o">-&gt;</span><span class="n">getModelFrame</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>

<span class="c1">// construct a RobotState that maintains the configuration of the robot</span>
<span class="n">robot_state</span><span class="o">::</span><span class="n">RobotStatePtr</span> <span class="nf">kinematic_state</span><span class="p">(</span><span class="k">new</span> <span class="n">robot_state</span><span class="o">::</span><span class="n">RobotState</span><span class="p">(</span><span class="n">kinematic_model</span><span class="p">));</span>
<span class="c1">// set all joints in the states to the default values</span>
<span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">setToDefaultValues</span><span class="p">();</span>

<span class="c1">// get a JointModelGroup, which represent the robot modle for a particular group</span>
<span class="k">const</span> <span class="n">robot_state</span> <span class="n">JointModelGroup</span><span class="s">" joint_model_group = kinematic_model-&gt;getJointModelGroup("</span><span class="n">panda_arm</span><span class="s">");</span><span class="err">
</span><span class="s">const std::vector&amp;lt;std::string&gt;&amp;amp; joint_names = joint_model_group-&gt;getVariableNames();</span><span class="err">
</span></code></pre></div></div>

<h3 id="get-joint-values">Get Joint Values</h3>
<p>è·å–Panda Armå„å…³èŠ‚çš„è§’åº¦.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">joint_values</span><span class="p">;</span>
<span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">copyJointGroupPosiions</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">,</span> <span class="n">joint_values</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">joint_names</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">"Joint %s: %f"</span><span class="p">,</span> <span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">joint_values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="joint-limits">Joint Limits</h3>
<p>å…³èŠ‚æé™å¯ä»¥é€šè¿‡<code class="language-plaintext highlighter-rouge">enforceBounds()</code>æ¥è®¾ç½®.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Set one joint in the Panda Arm outside its joint limit</span>
<span class="n">joint_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.57</span><span class="p">;</span>
<span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">setJointGroupPositions</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">,</span> <span class="n">joint_values</span><span class="p">);</span>

<span class="c1">// Check whether any joint is outside its joint limits</span>
<span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">"Current state is "</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">kinematic_sate</span><span class="o">-&gt;</span><span class="n">satisfiesBounds</span><span class="p">()</span> <span class="o">?</span> <span class="s">"valid"</span> <span class="o">:</span> <span class="s">"not valid"</span><span class="p">));</span>

<span class="c1">// Enforce the joint limits for this state and check again</span>
<span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">enforceBounds</span><span class="p">();</span>
<span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">"Current state is "</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">satisfiesBounds</span><span class="p">()</span> <span class="o">?</span> <span class="s">"valid"</span> <span class="o">:</span> <span class="s">"not valid"</span><span class="p">));</span>
</code></pre></div></div>

<h3 id="forward-kinematics">Forward Kinematics</h3>
<p>æ¥ä¸‹æ¥éšæœºè®¾ç½®ä¸€ç»„å…³èŠ‚è§’åº¦ï¼Œåˆ©ç”¨æ­£è¿åŠ¨å­¦è®¡ç®—å‡ºPanda Armæœ«ç«¯é“¾æ¥â€œpanda_link8â€çš„å§¿åŠ¿ã€‚</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">setToRandomPositions</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">);</span>
<span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Isometry3d</span><span class="o">&amp;</span> <span class="n">end_effector_state</span> <span class="o">=</span> <span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">getGlobalLinkTransform</span><span class="p">(</span><span class="s">"panda_link8"</span><span class="p">);</span>

<span class="c1">// Print end-effector pose. Remember that this is in the model frame</span>
<span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">"Translation: Â¥n"</span> <span class="o">&lt;&lt;</span> <span class="n">end_effector_state</span><span class="p">.</span><span class="n">translation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Â¥n"</span><span class="p">);</span>
<span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">"Rotation: Â¥n"</span> <span class="o">&lt;&lt;</span> <span class="n">end_effector_state</span><span class="p">.</span><span class="n">rotation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Â¥n"</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="inverse-kinematics">Inverse Kinematics</h3>
<p>è§£å†³Panda Armçš„é€†è¿åŠ¨å­¦éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
  <li>æœ«ç«¯æ‰§è¡Œå™¨çš„æœŸæœ›å§¿åŠ¿ã€‚è¿™é‡Œä½¿ç”¨åœ¨æ­£è¿åŠ¨å­¦ä¸­è§£å‡ºçš„<code class="language-plaintext highlighter-rouge">end_effector_state</code></li>
  <li>timeout: 0.1s</li>
</ol>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">found_ik</span> <span class="o">=</span> <span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">setFromIK</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">,</span> <span class="n">end_effector_state</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">found_ik</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">kinematic_state</span><span class="o">-&gt;</span><span class="n">copyJointGroupPositions</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">,</span> <span class="n">joint_values</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">joint_names</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">"Joint %s: %f"</span><span class="p">,</span> <span class="n">joint_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">joint_values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">"Did not find IK solution"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
:ET